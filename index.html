<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>电影推荐宝典</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: '#4F46E5', // 更深的霓虹紫
        secondary: '#0EA5E9', // 霓虹蓝
        tertiary: '#10B981', // 霓虹绿
        accent: '#EC4899', // 霓虹粉
        dark: {
          bg: '#0F172A', // 深空间蓝
          card: '#1E293B', // 暗宇宙蓝
          text: '#E2E8F0' // 浅星光色
        }
      },
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'fade-in': 'fadeIn 0.5s ease-in-out',
        'fade-out': 'fadeOut 0.3s ease-in-out',
        'slide-up': 'slideUp 0.4s ease-out',
        'slide-in-right': 'slideInRight 0.5s ease-out',
        'slide-in-left': 'slideInLeft 0.5s ease-out',
        'scale-in': 'scaleIn 0.3s ease-out',
        'float': 'float 6s ease-in-out infinite',
        'wave': 'wave 2.5s ease-in-out infinite',
        'spin-slow': 'spin 8s linear infinite',
        'scan-line': 'scanLine 2s linear infinite',
        'typewriter': 'typewriter 2s steps(40) 1s 1 normal both',
        'data-pulse': 'dataPulse 1.5s ease-in-out infinite',
        'hologram': 'hologram 3s ease-in-out infinite',
      },
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' }
        },
        fadeOut: {
          '0%': { opacity: '1' },
          '100%': { opacity: '0' }
        },
        slideUp: {
          '0%': { transform: 'translateY(20px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' }
        },
        slideInRight: {
          '0%': { transform: 'translateX(30px)', opacity: '0' },
          '100%': { transform: 'translateX(0)', opacity: '1' }
        },
        slideInLeft: {
          '0%': { transform: 'translateX(-30px)', opacity: '0' },
          '100%': { transform: 'translateX(0)', opacity: '1' }
        },
        scaleIn: {
          '0%': { transform: 'scale(0.9)', opacity: '0' },
          '100%': { transform: 'scale(1)', opacity: '1' }
        },
        float: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' }
        },
        wave: {
          '0%': { transform: 'rotate(0deg)' },
          '25%': { transform: 'rotate(10deg)' },
          '50%': { transform: 'rotate(0deg)' },
          '75%': { transform: 'rotate(-10deg)' },
          '100%': { transform: 'rotate(0deg)' }
        },
        scanLine: {
            '0%': { transform: 'translateY(0)' },
            '100%': { transform: 'translateY(100%)' }
        },
        typewriter: {
            '0%': { width: '0' },
            '100%': { width: '100%' }
        },
        dataPulse: {
            '0%, 100%': { opacity: '0.6', transform: 'scale(1)' },
            '50%': { opacity: '1', transform: 'scale(1.05)' }
        },
        hologram: {
            '0%, 100%': { opacity: '0.8', filter: 'blur(0)' },
            '50%': { opacity: '1', filter: 'blur(1px)' }
        }
      },
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
      }
    }
  }
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

:root {
  --shimmer-light: linear-gradient(to right, #f6f7f8 8%, #edeef1 18%, #f6f7f8 33%);
  --shimmer-dark: linear-gradient(to right, #333 8%, #3a3a3a 18%, #333 33%);
}

body {
  font-family: 'Noto Sans SC', sans-serif;
  transition: background-color 0.3s, color 0.3s;
  scrollbar-width: thin;
  scrollbar-color: var(--scroll-thumb) var(--scroll-track);
}

.movie-poster {
  position: relative;
  overflow: hidden;
}

.movie-poster::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='0.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M19.82 2H4.18C2.97 2 2 2.97 2 4.18v15.64C2 21.03 2.97 22 4.18 22h15.64c1.21 0 2.18-.97 2.18-2.18V4.18C22 2.97 21.03 2 19.82 2Z'/%3E%3Cpath d='M7 2v20'/%3E%3Cpath d='M17 2v20'/%3E%3Cpath d='M2 12h20'/%3E%3Cpath d='M2 7h5'/%3E%3Cpath d='M2 17h5'/%3E%3Cpath d='M17 17h5'/%3E%3Cpath d='M17 7h5'/%3E%3C/svg%3E");
  opacity: 0.12;
  background-size: 60px 60px;
}

.movie-card {
  transition: transform 0.3s, box-shadow 0.3s;
}

.movie-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.featured-card {
  position: relative;
  overflow: hidden;
}

.featured-card::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: inherit;
  padding: 2px;
  background: linear-gradient(120deg, #5D5CDE, #FF6584);
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
}

.autocomplete-item {
  transition: background-color 0.2s;
}

.similarity-bar {
  transition: width 1s ease-out;
  width: 0;
}

@keyframes shimmer {
  0% {
    background-position: -468px 0;
  }
  100% {
    background-position: 468px 0;
  }
}

.loading-shimmer {
  animation-duration: 1.5s;
  animation-fill-mode: forwards;
  animation-iteration-count: infinite;
  animation-name: shimmer;
  animation-timing-function: linear;
  background: var(--shimmer-light);
  background-size: 800px 104px;
}

.dark .loading-shimmer {
  background: var(--shimmer-dark);
}

.recommendation-card {
  opacity: 0;
  transform: scale(0.95);
}

.blurred-bg {
  backdrop-filter: blur(8px);
}

.dark .blurred-bg {
  background-color: rgba(30, 30, 30, 0.8);
}

.light .blurred-bg {
  background-color: rgba(255, 255, 255, 0.8);
}

/* Glowing effect */
.glow-effect {
  position: relative;
}

.glow-effect::before {
  content: '';
  position: absolute;
  inset: -5px;
  border-radius: inherit;
  padding: 5px;
  background: radial-gradient(circle at 50% 50%, rgba(93, 92, 222, 0.8), transparent 70%);
  filter: blur(15px);
  opacity: 0;
  z-index: -1;
  transition: opacity 0.3s ease;
}

.glow-effect:hover::before {
  opacity: 0.7;
}

.dark .glow-effect::before {
  background: radial-gradient(circle at 50% 50%, rgba(93, 92, 222, 0.7), transparent 70%);
}

/* Film strip border effect */
.film-border {
  --border-size: 8px;
  --border-angle: 0deg;
  --border-bg: conic-gradient(
    from var(--border-angle),
    #5D5CDE, 
    #8583FF, 
    #5D5CDE
  );
  background-image: var(--border-bg);
  animation: borderRotate 6s linear infinite;
}

@keyframes borderRotate {
  to {
    --border-angle: 360deg;
  }
}

@property --border-angle {
  syntax: "<angle>";
  initial-value: 0deg;
  inherits: false;
}

/* Better focus styles */
button:focus-visible, input:focus-visible {
  outline: 2px solid var(--tw-ring-color);
  outline-offset: 2px;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background-color: rgba(156, 163, 175, 0.5);
  border-radius: 20px;
}

.dark ::-webkit-scrollbar-thumb {
  background-color: rgba(75, 85, 99, 0.5);
}

/* Better light/dark mode transition */
html.transitioning * {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, fill 0.3s ease !important;
}

/* Card hover effects */
.card-hover {
  transition: all 0.3s ease;
  transform-style: preserve-3d;
  perspective: 1000px;
}

.card-hover:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 20px 30px -15px rgba(93, 92, 222, 0.25);
}

/* Genres pills with gradient */
.genre-pill {
  background-size: 200% auto;
  background-position: 0 0;
  transition: background-position 0.5s ease;
}

.genre-pill:hover {
  background-position: 100% 0;
}

/* Cinematic film visual */
.film-reel-bg {
  position: relative;
}

.film-reel-bg::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 20px;
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 12px,
    rgba(0, 0, 0, 0.2) 12px,
    rgba(0, 0, 0, 0.2) 24px
  );
  z-index: 1;
}

.film-reel-bg::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 20px;
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 12px,
    rgba(0, 0, 0, 0.2) 12px,
    rgba(0, 0, 0, 0.2) 24px
  );
  z-index: 1;
}

.dark .film-reel-bg::before,
.dark .film-reel-bg::after {
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 12px,
    rgba(255, 255, 255, 0.15) 12px,
    rgba(255, 255, 255, 0.15) 24px
  );
}
.neon-glow {
  box-shadow: 0 0 10px rgba(79, 70, 229, 0.6), 
              0 0 20px rgba(79, 70, 229, 0.4), 
              0 0 30px rgba(79, 70, 229, 0.2);
}

.dark .neon-glow {
  box-shadow: 0 0 10px rgba(79, 70, 229, 0.8), 
              0 0 20px rgba(79, 70, 229, 0.6), 
              0 0 30px rgba(79, 70, 229, 0.4);
}

/* 高科技边框 */
.tech-border {
  position: relative;
  border: 1px solid transparent;
  background-clip: padding-box;
}

.tech-border::before {
  content: '';
  position: absolute;
  inset: 0;
  margin: -2px;
  border-radius: inherit;
  background: linear-gradient(45deg, #4F46E5, #0EA5E9, #10B981, #EC4899);
  z-index: -1;
  animation: borderGlow 3s linear infinite;
}

@keyframes borderGlow {
  0% { opacity: 0.5; }
  50% { opacity: 1; }
  100% { opacity: 0.5; }
}

/* 高科技数据线条背景 */
.circuit-bg {
  position: relative;
  overflow: hidden;
}

.circuit-bg::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10 H 90 V 90 H 10 L 10 10' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M30 10 V 30 H 10' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M70 10 V 30 H 90' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M30 90 V 70 H 10' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M70 90 V 70 H 90' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M10 50 H 30' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M70 50 H 90' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M50 10 V 30' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3Cpath d='M50 70 V 90' fill='none' stroke='%234F46E510' stroke-width='1'/%3E%3C/svg%3E");
  opacity: 0.5;
  z-index: -1;
}

.dark .circuit-bg::before {
  opacity: 0.2;
}
/* 替换电影胶片效果为科幻数据流 */
.film-reel-bg::before,
.film-reel-bg::after {
  content: '';
  position: absolute;
  height: 20px;
  left: 0;
  right: 0;
  background-image: 
    linear-gradient(90deg, 
      transparent 0%, rgba(79, 70, 229, 0.1) 10%, 
      rgba(14, 165, 233, 0.1) 20%, transparent 30%,
      transparent 40%, rgba(16, 185, 129, 0.1) 50%,
      rgba(236, 72, 153, 0.1) 60%, transparent 70%,
      transparent 80%, rgba(79, 70, 229, 0.1) 90%,
      transparent 100%);
  background-size: 200% 100%;
  animation: dataStream 10s linear infinite;
  z-index: 1;
}

.film-reel-bg::before {
  top: 0;
}

.film-reel-bg::after {
  bottom: 0;
}

@keyframes dataStream {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.dark .film-reel-bg::before,
.dark .film-reel-bg::after {
  background-image: 
    linear-gradient(90deg, 
      transparent 0%, rgba(79, 70, 229, 0.3) 10%, 
      rgba(14, 165, 233, 0.3) 20%, transparent 30%,
      transparent 40%, rgba(16, 185, 129, 0.3) 50%,
      rgba(236, 72, 153, 0.3) 60%, transparent 70%,
      transparent 80%, rgba(79, 70, 229, 0.3) 90%,
      transparent 100%);
}
</style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-dark-bg text-gray-900 dark:text-dark-text transition-colors">
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <header class="text-center mb-10 animate-fade-in relative">
        <div class="absolute -top-16 left-1/2 -translate-x-1/2 w-full max-w-md h-32 bg-gradient-radial from-primary/40 to-transparent opacity-70 blur-3xl -z-10 animate-data-pulse"></div>
        <div class="inline-block relative mb-3">
            <!-- 替换电影图标为高科技图标 -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-primary mx-auto animate-spin-slow neon-glow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
            <path d="M18 12a6 6 0 0 0-6-6"></path>
            <path d="M6 12a6 6 0 0 0 6 6"></path>
            </svg>
            <span class="absolute -right-1 -top-1 flex h-6 w-6">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"></span>
            <span class="relative inline-flex rounded-full h-6 w-6 bg-accent text-white text-xs flex items-center justify-center">新</span>
            </span>
        </div>
        <h1 class="text-5xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-primary via-secondary to-accent animate-hologram">电影推荐宝典</h1>
        <p class="text-gray-600 dark:text-gray-400 max-w-xl mx-auto">输入一部您喜欢的电影，立即获取个性化推荐和深度解析</p>
    </header>

  <div class="max-w-4xl mx-auto">
    <!-- 搜索区域 -->
    <div class="bg-white dark:bg-dark-card rounded-2xl shadow-lg p-6 transition-all mb-8 relative film-reel-bg card-hover">
      <div class="absolute -top-24 -right-24 w-48 h-48 bg-primary/10 rounded-full blur-3xl"></div>
      <div class="relative z-10">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          查找电影
        </h2>

        <div class="relative">
          <input
            type="text"
            id="movie-input"
            class="w-full p-4 pr-12 text-base border border-gray-300 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800 focus:ring-2 focus:ring-primary focus:border-primary transition"
            placeholder="输入您喜欢的电影名称..."
            autocomplete="off"
            aria-label="电影名称"
            aria-autocomplete="list"
            aria-controls="autocomplete-results"
          >
          <button
            id="search-movie-btn"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-primary hover:text-secondary p-2 rounded-lg transition-colors focus:ring-2 focus:ring-primary"
            aria-label="搜索电影"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </button>
          <div
            id="autocomplete-results"
            class="absolute z-50 left-0 right-0 mt-1 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border border-gray-300 dark:border-gray-700 rounded-xl shadow-xl max-h-72 overflow-y-auto hidden"
            role="listbox"
            ></div>
        </div>
      </div>
    </div>

    <!-- 精选电影推荐 -->
    <div id="featured-movies" class="mb-12 animate-fade-in">
      <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        精选推荐
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <!-- 精选电影将通过JS动态生成 -->
      </div>
    </div>

    <!-- 主要内容区域 -->
    <div id="recommendation-container" class="bg-white dark:bg-dark-card rounded-2xl shadow-lg p-6 transition-all animate-fade-in relative overflow-hidden">
      <div class="absolute top-0 right-0 w-64 h-64 bg-accent/5 rounded-full blur-3xl -z-0"></div>
      <div class="absolute bottom-0 left-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl -z-0"></div>
      
      <!-- 初始状态 -->
      <div id="initial-state" class="flex flex-col items-center justify-center py-16 text-center relative z-10">
        <div class="w-28 h-28 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mb-6 animate-pulse-slow">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19.82 2H4.18C2.97 2 2 2.97 2 4.18v15.64C2 21.03 2.97 22 4.18 22h15.64c1.21 0 2.18-.97 2.18-2.18V4.18C22 2.97 21.03 2 19.82 2Z"></path>
            <path d="M7 2v20"></path>
            <path d="M17 2v20"></path>
            <path d="M2 12h20"></path>
            <path d="M2 7h5"></path>
            <path d="M2 17h5"></path>
            <path d="M17 17h5"></path>
            <path d="M17 7h5"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-3">发现您的下一部最爱</h3>
        <p class="text-gray-600 dark:text-gray-400 max-w-md mb-6">搜索您喜欢的电影，获取个性化推荐和相似电影的深度解析。</p>
        
        <div class="flex flex-wrap justify-center gap-2 max-w-md">
          <!-- 热门标签 -->
          <button class="quick-search-tag bg-primary/10 hover:bg-primary/20 text-primary px-3 py-1 rounded-full text-sm transition-colors">动作</button>
          <button class="quick-search-tag bg-accent/10 hover:bg-accent/20 text-accent px-3 py-1 rounded-full text-sm transition-colors">爱情</button>
          <button class="quick-search-tag bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-500 px-3 py-1 rounded-full text-sm transition-colors">科幻</button>
          <button class="quick-search-tag bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 px-3 py-1 rounded-full text-sm transition-colors">动画</button>
          <button class="quick-search-tag bg-violet-500/10 hover:bg-violet-500/20 text-violet-500 px-3 py-1 rounded-full text-sm transition-colors">悬疑</button>
        </div>
      </div>

      <!-- 加载状态 -->
      <div id="loading-state" class="py-8 hidden" aria-live="polite">
        <div class="flex flex-col items-center justify-center">
          <div class="relative w-20 h-20 mb-6">
            <div class="w-20 h-20 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19.82 2H4.18C2.97 2 2 2.97 2 4.18v15.64C2 21.03 2.97 22 4.18 22h15.64c1.21 0 2.18-.97 2.18-2.18V4.18C22 2.97 21.03 2 19.82 2Z"></path>
              <path d="M7 2v20"></path>
              <path d="M17 2v20"></path>
              <path d="M2 12h20"></path>
              <path d="M2 7h5"></path>
              <path d="M2 17h5"></path>
              <path d="M17 17h5"></path>
              <path d="M17 7h5"></path>
            </svg>
          </div>
          <p class="text-gray-600 dark:text-gray-400 text-lg mb-2" id="loading-text">正在寻找完美匹配...</p>
          <p class="text-gray-500 dark:text-gray-500 text-sm italic" id="loading-subtext">分析电影风格与元素</p>
        </div>

        <div class="mt-10 space-y-6">
          <div class="h-40 bg-gray-200 dark:bg-gray-700 rounded-xl loading-shimmer"></div>
          <div class="h-40 bg-gray-200 dark:bg-gray-700 rounded-xl loading-shimmer" style="animation-delay: 0.15s"></div>
          <div class="h-40 bg-gray-200 dark:bg-gray-700 rounded-xl loading-shimmer" style="animation-delay: 0.3s"></div>
        </div>
      </div>

      <!-- 推荐结果 -->
      <div id="recommendation-results" class="hidden" aria-live="polite">
        <!-- 所选电影 -->
        <div id="selected-movie-display" class="mb-8"></div>
        
        <!-- 推荐电影列表 -->
        <div class="space-y-6">
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            为您推荐
          </h2>
          <div id="recommendations-list" class="space-y-6"></div>
        </div>
      </div>

      <!-- AI推荐（针对未知电影） -->
      <div id="unknown-movie-results" class="hidden" aria-live="polite">
        <div class="featured-card bg-gradient-to-r from-primary/10 to-accent/10 dark:from-primary/20 dark:to-accent/20 rounded-xl p-4 mb-6">
          <div class="flex items-start">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 16v-4"></path>
              <path d="M12 8h.01"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-900 dark:text-white">电影未在本地数据库中找到</p>
              <p class="text-gray-600 dark:text-gray-400 text-sm">以下是基于AI的个性化推荐：</p>
            </div>
          </div>
        </div>
        <div id="ai-recommendation" class="prose dark:prose-invert max-w-none"></div>
      </div>
    </div>

    <!-- 电影详情模态框 -->
    <div id="movie-details-modal" class="fixed inset-0 bg-black/50 dark:bg-black/70 z-50 flex items-center justify-center hidden backdrop-blur-sm transition-opacity duration-300 opacity-0">
      <div class="bg-white dark:bg-dark-card rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-4 transition-transform duration-300 transform scale-95">
        <div id="movie-details-content" class="p-6">
          <!-- 电影详情内容将通过JS动态生成 -->
        </div>
      </div>
    </div>
  </div>

  <!-- 提示消息容器 -->
  <div id="toast-container" class="fixed top-4 right-4 z-50" aria-live="polite"></div>
</div>

<script>
// 检测暗色模式
function setColorMode() {
  document.documentElement.classList.add('transitioning');

  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.add('light');
  }

  setTimeout(() => {
    document.documentElement.classList.remove('transitioning');
  }, 300);
}

setColorMode();

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
  document.documentElement.classList.add('transitioning');

  if (event.matches) {
    document.documentElement.classList.add('dark');
    document.documentElement.classList.remove('light');
  } else {
    document.documentElement.classList.remove('dark');
    document.documentElement.classList.add('light');
  }

  setTimeout(() => {
    document.documentElement.classList.remove('transitioning');
  }, 300);
});

// 扩展的电影数据库 - 使用更高效的数据结构
import { movies } from './movies.js';

// 创建类型颜色映射对象
const genreColors = {
  "剧情": { color: "#3498db", gradient: "from-blue-500 to-blue-600" },
  "犯罪": { color: "#e74c3c", gradient: "from-red-500 to-red-600" },
  "动作": { color: "#f39c12", gradient: "from-amber-500 to-amber-600" },
  "冒险": { color: "#2ecc71", gradient: "from-green-500 to-green-600" },
  "科幻": { color: "#9b59b6", gradient: "from-purple-500 to-purple-600" },
  "爱情": { color: "#e84393", gradient: "from-pink-500 to-pink-600" },
  "动画": { color: "#00b894", gradient: "from-teal-500 to-teal-600" },
  "家庭": { color: "#fdcb6e", gradient: "from-yellow-400 to-yellow-500" },
  "悬疑": { color: "#6c5ce7", gradient: "from-indigo-500 to-indigo-600" },
  "奇幻": { color: "#a29bfe", gradient: "from-violet-400 to-violet-500" },
  "喜剧": { color: "#fd79a8", gradient: "from-pink-400 to-rose-400" },
  "惊悚": { color: "#d63031", gradient: "from-red-600 to-red-700" },
  "恐怖": { color: "#2d3436", gradient: "from-gray-700 to-gray-800" },
  "音乐": { color: "#74b9ff", gradient: "from-blue-400 to-sky-400" }
};

// 相似度计算缓存
const similarityCache = new Map();

// 计算电影相似度（基于共同关键词、导演和类型）
function calculateSimilarity(movie1, movie2) {
  // 使用缓存减少重复计算
  const cacheKey = `${movie1.id}-${movie2.id}`;
  const reverseCacheKey = `${movie2.id}-${movie1.id}`;

  if (similarityCache.has(cacheKey)) {
    return similarityCache.get(cacheKey);
  } else if (similarityCache.has(reverseCacheKey)) {
    return similarityCache.get(reverseCacheKey);
  }

  let score = 0;

  // 共同类型 - 高权重 (最大30分)
  const commonGenres = movie1.genres.filter(g => movie2.genres.includes(g));
  score += commonGenres.length * 10;

  // 同一导演 - 高权重 (20分)
  if (movie1.director === movie2.director) {
    score += 20;
  }

  // 共同关键词 - 中权重 (最大25分)
  const keywords1 = new Set(movie1.keywords);
  const commonKeywords = movie2.keywords.filter(k => keywords1.has(k));
  score += commonKeywords.length * 5;

  // 相似年代 (最大10分)
  const yearDiff = Math.abs(movie1.year - movie2.year);
  if (yearDiff < 5) {
    score += 10;
  } else if (yearDiff < 10) {
    score += 5;
  } else if (yearDiff < 15) {
    score += 2;
  }

  // 相似国家/地区 (10分)
  const countries1 = new Set(movie1.countries);
  const commonCountries = movie2.countries.filter(c => countries1.has(c));
  if (commonCountries.length > 0) {
    score += 10;
  }

  // 共同演员 (最大10分)
  const cast1 = new Set(movie1.cast);
  const commonCast = movie2.cast.filter(a => cast1.has(a));
  score += commonCast.length * 5;

  // 最高分数100分
  const finalScore = Math.min(Math.round(score), 100);

  // 存入缓存
  similarityCache.set(cacheKey, finalScore);

  return finalScore;
}

// 根据用户选择的电影获取推荐
function getRecommendations(selectedMovie) {
  // 找出除了用户选择的电影之外的所有电影
  const otherMovies = movies.filter(m => m.id !== selectedMovie.id);

  // 计算每部电影与所选电影的相似度
  const recommendationScores = otherMovies.map(movie => {
    const similarity = calculateSimilarity(selectedMovie, movie);

    // 生成推荐原因
    let reasons = [];

    if (selectedMovie.director === movie.director) {
      reasons.push(`同一导演: ${movie.director}`);
    }

    const commonGenres = selectedMovie.genres.filter(g => movie.genres.includes(g));
    if (commonGenres.length > 0) {
      reasons.push(`相似类型: ${commonGenres.join(', ')}`);
    }

    const commonKeywords = selectedMovie.keywords.filter(k => movie.keywords.includes(k));
    if (commonKeywords.length > 1) {
      reasons.push(`相似元素: ${commonKeywords.join(', ')}`);
    }

    // 共同演员
    const cast1 = new Set(selectedMovie.cast);
    const commonCast = movie.cast.filter(a => cast1.has(a));
    if (commonCast.length > 0) {
      reasons.push(`共同演员: ${commonCast.join(', ')}`);
    }

    // 如果没有找到原因但相似度高，添加一个通用原因
    if (reasons.length === 0 && similarity > 60) {
      reasons.push(`整体风格与《${selectedMovie.title}》相似`);
    }

    return {
      movie,
      score: similarity,
      reasons
    };
  });

  // 按相似度降序排序并返回前6个结果
  return recommendationScores
    .sort((a, b) => b.score - a.score)
    .slice(0, 6);
}

// 生成电影卡片渐变色
function generateMovieCardGradient(genres) {
  if (!genres || genres.length === 0) {
    return "linear-gradient(135deg, #5D5CDE 0%, #4E4DC5 100%)";
  }

  if (genres.length === 1) {
    const color = genreColors[genres[0]]?.color || "#5D5CDE";
    const lighterColor = adjustColor(color, 30);
    return `linear-gradient(135deg, ${color} 0%, ${lighterColor} 100%)`;
  }

  // 使用前两个类型的颜色创建渐变
  const color1 = genreColors[genres[0]]?.color || "#5D5CDE";
  const color2 = genreColors[genres[1]]?.color || "#4E4DC5";
  return `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
}

// 调整色彩明度
function adjustColor(hex, amount) {
  // 转换为RGB
  let r = parseInt(hex.substring(1, 3), 16);
  let g = parseInt(hex.substring(3, 5), 16);
  let b = parseInt(hex.substring(5, 7), 16);

  // 柔和的亮度调整
  r = Math.min(255, Math.max(0, r + amount));
  g = Math.min(255, Math.max(0, g + amount));
  b = Math.min(255, Math.max(0, b + amount));

  // 转回十六进制
  return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
}

// DOM 元素
const elements = {
  movieInput: document.getElementById('movie-input'),
  autocompleteResults: document.getElementById('autocomplete-results'),
  searchMovieBtn: document.getElementById('search-movie-btn'),
  featuredMovies: document.getElementById('featured-movies'),
  initialState: document.getElementById('initial-state'),
  loadingState: document.getElementById('loading-state'),
  recommendationResults: document.getElementById('recommendation-results'),
  selectedMovieDisplay: document.getElementById('selected-movie-display'),
  recommendationsList: document.getElementById('recommendations-list'),
  unknownMovieResults: document.getElementById('unknown-movie-results'),
  aiRecommendation: document.getElementById('ai-recommendation'),
  loadingText: document.getElementById('loading-text'),
  loadingSubtext: document.getElementById('loading-subtext'),
  toastContainer: document.getElementById('toast-container'),
  movieDetailsModal: document.getElementById('movie-details-modal'),
  movieDetailsContent: document.getElementById('movie-details-content'),
  quickSearchTags: document.querySelectorAll('.quick-search-tag')
};

// 应用状态
const appState = {
  selectedMovie: null,
  loadingStates: [
    { main: "正在分析您的电影偏好...", sub: "提取关键要素" },
    { main: "搜索相似电影...", sub: "计算匹配度" },
    { main: "寻找完美推荐...", sub: "对比风格与题材" },
    { main: "定制个性化推荐...", sub: "排序最佳匹配" }
  ],
  loadingStateIndex: 0,
  loadingInterval: null,
  autocompleteSelectedIndex: -1,
  lastSearchTerm: '',
  modalIsOpen: false
};

// 初始化应用
initApp();

function initApp() {
  // 显示精选电影
  displayFeaturedMovies();
  
  // 设置事件监听器
  setupEventListeners();
}

// 显示精选电影
function displayFeaturedMovies() {
  // 选择评分最高的8部电影作为精选
  const featured = [...movies]
    .sort((a, b) => b.rating - a.rating)
    .slice(0, 8);
  
  const featuredContainer = elements.featuredMovies.querySelector('.grid');
  featuredContainer.innerHTML = '';
  
  featured.forEach(movie => {
    const movieCard = document.createElement('div');
    movieCard.className = 'featured-movie-card card-hover rounded-lg overflow-hidden cursor-pointer transform transition-all duration-300';
    movieCard.dataset.id = movie.id;
    
    const gradient = generateMovieCardGradient(movie.genres);
    
    movieCard.innerHTML = `
      <div class="aspect-[2/3] relative movie-poster" style="background: ${gradient}">
        <div class="absolute inset-0 flex flex-col items-center justify-center p-2 text-white">
          <h3 class="font-bold text-center">${movie.title}</h3>
          <p class="text-xs text-white/80 mt-1">${movie.year}</p>
        </div>
        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span class="text-xs ml-1 text-white">${movie.rating}</span>
            </div>
            <div class="text-xs text-white/80">${movie.genres[0]}</div>
          </div>
        </div>
      </div>
    `;
    
    featuredContainer.appendChild(movieCard);
    
    // 添加点击事件
    movieCard.addEventListener('click', () => {
      selectMovie(movie);
    });
  });
}

// 设置事件监听器
function setupEventListeners() {
  // 搜索输入框
  elements.movieInput.addEventListener('input', debounce((e) => {
    updateAutocomplete(e.target.value);
  }, 200));

  // 搜索按钮
  elements.searchMovieBtn.addEventListener('click', () => {
    const input = elements.movieInput.value.trim();
    if (input) {
      handleMovieSearch(input);
    }
  });

  // 输入框回车
  elements.movieInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const input = elements.movieInput.value.trim();
      if (input) {
        handleMovieSearch(input);
      }
    } else if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
      handleAutocompleteNavigation(e);
    }
  });

  // 自动补全结果点击
  elements.autocompleteResults.addEventListener('click', (e) => {
    const item = e.target.closest('.autocomplete-item');
    if (item) {
      const movieId = parseInt(item.dataset.id);
      const movie = movies.find(m => m.id === movieId);
      if (movie) {
        selectMovie(movie);
      }
    }
  });

  // 快速搜索标签点击
  elements.quickSearchTags.forEach(tag => {
    tag.addEventListener('click', () => {
      elements.movieInput.value = tag.textContent;
      handleMovieSearch(tag.textContent);
    });
  });

  // 模态框关闭
  elements.movieDetailsModal.addEventListener('click', (e) => {
    if (e.target === elements.movieDetailsModal) {
      closeMovieDetailsModal();
    }
  });

  // 点击外部关闭自动补全
  document.addEventListener('click', (e) => {
    if (!elements.movieInput.contains(e.target) && !elements.autocompleteResults.contains(e.target)) {
      elements.autocompleteResults.classList.add('hidden');
    }
  });

  // 为ESC键添加监听
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (appState.modalIsOpen) {
        closeMovieDetailsModal();
      } else if (!elements.autocompleteResults.classList.contains('hidden')) {
        elements.autocompleteResults.classList.add('hidden');
      }
    }
  });
}

// 处理自动补全导航
function handleAutocompleteNavigation(e) {
  const autocompleteItems = elements.autocompleteResults.querySelectorAll('.autocomplete-item');
  
  if (elements.autocompleteResults.classList.contains('hidden') || autocompleteItems.length === 0) {
    return;
  }

  e.preventDefault();
  
  if (e.key === 'ArrowDown') {
    appState.autocompleteSelectedIndex = (appState.autocompleteSelectedIndex + 1) % autocompleteItems.length;
  } else if (e.key === 'ArrowUp') {
    appState.autocompleteSelectedIndex = (appState.autocompleteSelectedIndex - 1 + autocompleteItems.length) % autocompleteItems.length;
  }

  updateSelectedAutocompleteItem(autocompleteItems);
}

// 更新选中的自动补全项
function updateSelectedAutocompleteItem(items) {
  items.forEach((item, index) => {
    if (index === appState.autocompleteSelectedIndex) {
      item.classList.add('bg-gray-100', 'dark:bg-gray-700');
      item.setAttribute('aria-selected', 'true');
      item.scrollIntoView({ block: 'nearest' });
    } else {
      item.classList.remove('bg-gray-100', 'dark:bg-gray-700');
      item.setAttribute('aria-selected', 'false');
    }
  });
}

// 自动补全功能
function updateAutocomplete(input) {
  const searchTerm = input.toLowerCase().trim();

  // 缓存检查
  if (searchTerm === appState.lastSearchTerm) return;
  appState.lastSearchTerm = searchTerm;

  if (searchTerm.length < 1) {
    elements.autocompleteResults.innerHTML = '';
    elements.autocompleteResults.classList.add('hidden');
    appState.autocompleteSelectedIndex = -1;
    return;
  }

  // 优化搜索 - 使用searchTerms字段
  const filteredMovies = movies.filter(movie =>
    movie.searchTerms.toLowerCase().includes(searchTerm) ||
    movie.title.toLowerCase().includes(searchTerm) ||
    (movie.englishTitle && movie.englishTitle.toLowerCase().includes(searchTerm))
  ).slice(0, 8); // 限制结果数量

  if (filteredMovies.length === 0) {
    elements.autocompleteResults.innerHTML = `
      <div class="py-2 px-4 text-gray-500 dark:text-gray-400 text-sm italic" role="option" aria-selected="false">未找到电影</div>
    `;
    elements.autocompleteResults.classList.remove('hidden');
    appState.autocompleteSelectedIndex = -1;
    return;
  }

  // 使用DocumentFragment优化DOM操作
  const fragment = document.createDocumentFragment();

  filteredMovies.forEach((movie, index) => {
    const item = document.createElement('div');
    item.className = 'autocomplete-item py-3 px-4 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors flex items-center';
    item.setAttribute('data-id', movie.id);
    item.setAttribute('role', 'option');
    item.setAttribute('aria-selected', 'false');
    item.setAttribute('tabindex', '-1');

    // 创建渐变色前景，用于剧种标签
    const gradientClass = movie.genres[0] ? genreColors[movie.genres[0]]?.gradient || 'from-primary to-secondary' : 'from-primary to-secondary';

    item.innerHTML = `
      <div class="flex-1">
        <div class="font-medium text-gray-900 dark:text-white">${movie.title}</div>
        <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
          <span class="mr-2">${movie.year}</span>
          ${movie.genres.slice(0, 2).map(genre => 
            `<span class="text-xs px-2 py-0.5 rounded-full genre-pill bg-gradient-to-r ${gradientClass} text-white mr-1">${genre}</span>`
          ).join('')}
        </div>
      </div>
      <div class="text-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </div>
    `;

    fragment.appendChild(item);
  });

  elements.autocompleteResults.innerHTML = '';
  elements.autocompleteResults.appendChild(fragment);
  elements.autocompleteResults.classList.remove('hidden');
  appState.autocompleteSelectedIndex = -1;
}

// 处理电影搜索
function handleMovieSearch(searchText) {
  // 先隐藏自动补全
  elements.autocompleteResults.classList.add('hidden');
  elements.movieInput.value = '';

  // 查找电影
  const movie = findMovieByTitle(searchText);

  if (movie) {
    selectMovie(movie);
  } else {
    // 未知电影，调用大语言模型
    handleUnknownMovie(searchText);
  }
}

// 智能电影搜索 - 考虑部分匹配和类型搜索
function findMovieByTitle(searchText) {
  const normalizedInput = searchText.toLowerCase().trim();

  // 1. 尝试直接匹配电影名
  const exactMatch = movies.find(m => 
    m.title.toLowerCase() === normalizedInput ||
    (m.englishTitle && m.englishTitle.toLowerCase() === normalizedInput)
  );
  if (exactMatch) return exactMatch;

  // 2. 尝试包含匹配
  const containsMatch = movies.find(m =>
    m.title.toLowerCase().includes(normalizedInput) ||
    (m.englishTitle && m.englishTitle.toLowerCase().includes(normalizedInput)) ||
    normalizedInput.includes(m.title.toLowerCase())
  );
  if (containsMatch) return containsMatch;

  // 3. 尝试匹配类型
  // 如果输入的是类型名称，随机返回该类型的一部高评分电影
  const isGenre = Object.keys(genreColors).some(genre => genre.toLowerCase() === normalizedInput);
  if (isGenre) {
    const genreMovies = movies.filter(m => 
      m.genres.some(g => g.toLowerCase() === normalizedInput)
    ).sort((a, b) => b.rating - a.rating);
    
    if (genreMovies.length > 0) {
      // 返回该类型中评分前3的随机一部
      const topMovies = genreMovies.slice(0, Math.min(3, genreMovies.length));
      return topMovies[Math.floor(Math.random() * topMovies.length)];
    }
  }

  // 4. 搜索词匹配
  return movies.find(m => m.searchTerms.toLowerCase().includes(normalizedInput));
}

// 选择电影
function selectMovie(movie) {
  appState.selectedMovie = movie;
  showLoadingState();

  // 动画和延迟逻辑
  let currentLoadingIndex = 0;
  elements.loadingText.textContent = appState.loadingStates[currentLoadingIndex].main;
  elements.loadingSubtext.textContent = appState.loadingStates[currentLoadingIndex].sub;

  appState.loadingInterval = setInterval(() => {
    currentLoadingIndex = (currentLoadingIndex + 1) % appState.loadingStates.length;
    elements.loadingText.textContent = appState.loadingStates[currentLoadingIndex].main;
    elements.loadingSubtext.textContent = appState.loadingStates[currentLoadingIndex].sub;
  }, 100);

  // 获取并显示推荐
  setTimeout(() => {
    clearInterval(appState.loadingInterval);
    showRecommendations(movie);
  }, 300);
}

// 显示加载状态
function showLoadingState() {
  elements.initialState.classList.add('hidden');
  elements.recommendationResults.classList.add('hidden');
  elements.unknownMovieResults.classList.add('hidden');
  elements.loadingState.classList.remove('hidden');

  // 重置加载动画
  const shimmerElements = elements.loadingState.querySelectorAll('.loading-shimmer');
  shimmerElements.forEach((el, index) => {
    el.style.animationDelay = `${index * 0.15}s`;
  });
}

// 显示推荐结果
function showRecommendations(movie) {
  const recommendations = getRecommendations(movie);

  elements.loadingState.classList.add('hidden');
  elements.recommendationResults.classList.remove('hidden');
  // 显示所选电影
  displaySelectedMovie(movie);

  // 显示推荐电影
  displayRecommendations(recommendations);

  window.location.href = "#recommendation-results";
  // 使用动画呈现
  animateRecommendations();
}

// 显示所选电影
function displaySelectedMovie(movie) {
  const gradient = generateMovieCardGradient(movie.genres);
  
  elements.selectedMovieDisplay.innerHTML = `
    <div class="featured-card bg-white dark:bg-dark-card rounded-xl shadow-lg overflow-hidden mb-8 animate-fade-in film-reel-bg">
      <div class="md:flex">
        <div class="movie-poster md:w-1/3 lg:w-1/4 h-48 md:h-auto relative flex-shrink-0" style="background-image: ${gradient}">
          <div class="absolute inset-0 flex flex-col items-center justify-center text-white p-4 text-center">
            <h2 class="text-2xl font-bold">${movie.title}</h2>
            <p class="text-white/80 mt-1">${movie.year}</p>
            <div class="mt-4 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-300" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span class="ml-1 font-medium">${movie.rating}</span>
            </div>
          </div>
        </div>
        <div class="md:w-2/3 lg:w-3/4 p-6">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                ${movie.title}
                <span class="ml-2 text-sm font-normal text-gray-500 dark:text-gray-400">${movie.englishTitle ? `(${movie.englishTitle})` : ''}</span>
              </h2>
              <p class="text-gray-600 dark:text-gray-400">
                <span class="inline-block mr-3">${movie.year}</span>
                <span class="inline-block">${movie.director}</span>
              </p>
            </div>
            <button 
              class="details-btn text-primary hover:text-secondary ml-4 p-2 rounded-full hover:bg-primary/10 transition-colors"
              data-id="${movie.id}"
              aria-label="查看电影详情"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </button>
          </div>
          
          <div class="flex flex-wrap gap-2 mb-4">
            ${movie.genres.map(genre => {
              const genreColor = genreColors[genre]?.gradient || 'from-primary to-secondary';
              return `<span class="px-3 py-1 rounded-full text-sm text-white bg-gradient-to-r ${genreColor} genre-pill">${genre}</span>`;
            }).join('')}
          </div>
          
          <p class="text-gray-700 dark:text-gray-300 mb-4">${movie.description}</p>
          
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <span class="text-gray-500 dark:text-gray-400">主演：</span>
              <span class="text-gray-700 dark:text-gray-300">${movie.cast.join('、')}</span>
            </div>
            <div>
              <span class="text-gray-500 dark:text-gray-400">地区：</span>
              <span class="text-gray-700 dark:text-gray-300">${movie.countries.join('、')}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  // 添加详情按钮事件
  elements.selectedMovieDisplay.querySelector('.details-btn').addEventListener('click', () => {
    showMovieDetailsModal(movie);
  });
}

// 显示推荐电影
function displayRecommendations(recommendations) {
  if (recommendations.length === 0) {
    elements.recommendationsList.innerHTML = `
      <div class="text-center py-8">
        <p class="text-gray-500 dark:text-gray-400">没有找到合适的推荐</p>
      </div>
    `;
    return;
  }

  elements.recommendationsList.innerHTML = '';
  
  recommendations.forEach((recommendation, index) => {
    const { movie, score, reasons } = recommendation;
    const gradient = generateMovieCardGradient(movie.genres);
    
    const recommendationCard = document.createElement('div');
    recommendationCard.className = 'recommendation-card transition-all duration-500';
    recommendationCard.style.animationDelay = `${index * 150}ms`;
    
    recommendationCard.innerHTML = `
      <div class="card-hover bg-white dark:bg-dark-card rounded-xl shadow-md overflow-hidden">
        <div class="md:flex">
          <div class="movie-poster md:w-1/4 h-40 md:h-auto flex-shrink-0 relative cursor-pointer" style="background-image: ${gradient}" data-id="${movie.id}">
            <div class="absolute inset-0 flex flex-col items-center justify-center text-white p-3 text-center">
              <div class="text-lg font-bold">${movie.title}</div>
              <div class="text-sm opacity-80">${movie.year}</div>
              <div class="mt-2 text-sm">
                <div class="flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-300" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                  <span class="ml-1">${movie.rating}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="md:w-3/4 p-5">
            <div class="flex justify-between items-start mb-3">
              <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                ${movie.title}
                <span class="ml-2 text-xs font-normal text-gray-500 dark:text-gray-400">${movie.englishTitle ? `(${movie.englishTitle})` : ''}</span>
              </h3>
              <div class="flex items-center ml-2 px-3 py-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full text-sm font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                </svg>
                <span>${score}% 匹配</span>
              </div>
            </div>

            <div class="mb-3">
              <div class="text-sm text-gray-600 dark:text-gray-400 mb-1 flex flex-wrap items-center">
                <span class="mr-3">${movie.director}</span>
                <div class="flex flex-wrap gap-1 mt-1">
                  ${movie.genres.map(genre => {
                    const genreColor = genreColors[genre]?.gradient || 'from-primary to-secondary';
                    return `<span class="px-2 py-0.5 rounded-full text-xs text-white bg-gradient-to-r ${genreColor} genre-pill">${genre}</span>`;
                  }).join('')}
                </div>
              </div>
            </div>

            <div class="similarity-container mb-3">
              <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1">
                <span>相似度</span>
                <span>${score}%</span>
              </div>
              <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div class="similarity-bar h-full rounded-full" style="width: 0%; background-image: ${gradient}"></div>
              </div>
            </div>

            <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-3">${movie.description}</p>

            ${reasons.length > 0 ? `
              <div class="mt-3 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium mb-1">推荐原因:</p>
                <ul class="text-xs text-gray-600 dark:text-gray-300 space-y-1">
                  ${reasons.slice(0, 3).map(reason => `<li class="flex items-start"><span class="text-primary mr-1">•</span> ${reason}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
        </div>
      </div>
    `;
    
    elements.recommendationsList.appendChild(recommendationCard);
    
    // 添加电影海报点击事件
    recommendationCard.querySelector('.movie-poster').addEventListener('click', () => {
      selectMovie(movie);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });
}

// 动画显示推荐结果
function animateRecommendations() {
  // 设置相似度条的延迟填充
  setTimeout(() => {
    const cards = elements.recommendationsList.querySelectorAll('.recommendation-card');
    
    cards.forEach((card, index) => {
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'scale(1)';
        card.classList.add('animate-scale-in');
        
        // 相似度条动画
        setTimeout(() => {
          const similarityBar = card.querySelector('.similarity-bar');
          if (similarityBar) {
            const scoreElement = card.querySelector('.similarity-container .flex span:last-child');
            const score = parseInt(scoreElement.textContent);
            similarityBar.style.width = `${score}%`;
          }
        }, 300);
      }, index * 150);
    });
  }, 300);
}

// 显示电影详情模态框
function showMovieDetailsModal(movie) {
  appState.modalIsOpen = true;
  
  const gradient = generateMovieCardGradient(movie.genres);
  const keywords = movie.keywords.map(k => `
    <span class="inline-block px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-sm mr-2 mb-2">${k}</span>
  `).join('');
  
  elements.movieDetailsContent.innerHTML = `
    <div class="flex justify-between items-start mb-4">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
        ${movie.title}
        <span class="ml-2 text-sm font-normal text-gray-500 dark:text-gray-400">${movie.englishTitle ? `(${movie.englishTitle})` : ''}</span>
      </h2>
      <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div class="md:flex gap-6">
      <div class="md:w-1/3 mb-6 md:mb-0">
        <div class="movie-poster aspect-[2/3] rounded-lg overflow-hidden" style="background-image: ${gradient}">
          <div class="h-full flex flex-col items-center justify-center text-white p-4 text-center">
            <h3 class="text-2xl font-bold">${movie.title}</h3>
            <p class="text-white/80 mt-1">${movie.year}</p>
            <div class="mt-6 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-300" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <span class="ml-1 text-xl font-bold">${movie.rating}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="md:w-2/3">
        <div class="flex flex-wrap gap-2 mb-6">
          ${movie.genres.map(genre => {
            const genreColor = genreColors[genre]?.gradient || 'from-primary to-secondary';
            return `<span class="px-3 py-1 rounded-full text-white bg-gradient-to-r ${genreColor} genre-pill">${genre}</span>`;
          }).join('')}
        </div>
        
        <div class="space-y-4">
          <div>
            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">剧情简介</h4>
            <p class="text-gray-700 dark:text-gray-300">${movie.description}</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">导演</h4>
              <p class="text-gray-700 dark:text-gray-300">${movie.director}</p>
            </div>
            
            <div>
              <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">上映年份</h4>
              <p class="text-gray-700 dark:text-gray-300">${movie.year}</p>
            </div>
            
            <div>
              <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">主演</h4>
              <p class="text-gray-700 dark:text-gray-300">${movie.cast.join('、')}</p>
            </div>
            
            <div>
              <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">地区</h4>
              <p class="text-gray-700 dark:text-gray-300">${movie.countries.join('、')}</p>
            </div>
          </div>
          
          <div>
            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">关键词</h4>
            <div class="flex flex-wrap">${keywords}</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
      <button id="find-similar-modal" class="w-full bg-primary hover:bg-secondary text-white font-medium py-3 px-4 rounded-lg transition-colors glow-effect">
        查找类似电影
      </button>
    </div>
  `;
  
  // 显示模态框
  elements.movieDetailsModal.classList.remove('hidden');
  setTimeout(() => {
    elements.movieDetailsModal.classList.add('opacity-100');
    elements.movieDetailsModal.querySelector('.scale-95').classList.remove('scale-95');
  }, 10);
  
  // 添加关闭按钮事件
  document.getElementById('close-modal').addEventListener('click', closeMovieDetailsModal);
  
  // 添加查找类似电影按钮事件
  document.getElementById('find-similar-modal').addEventListener('click', () => {
    closeMovieDetailsModal();
    selectMovie(movie);
  });
}

// 关闭电影详情模态框
function closeMovieDetailsModal() {
  appState.modalIsOpen = false;
  
  elements.movieDetailsModal.classList.remove('opacity-100');
  elements.movieDetailsModal.querySelector('div.bg-white').classList.add('scale-95');
  
  setTimeout(() => {
    elements.movieDetailsModal.classList.add('hidden');
  }, 300);
}

// 处理未知电影
async function handleUnknownMovie(movieTitle) {
  showLoadingState();
  elements.loadingText.textContent = `正在查询有关"${movieTitle}"的信息...`;
  elements.loadingSubtext.textContent = "使用AI分析电影特征";

  try {
    // 调用Claude大语言模型
    await window.Poe.sendUserMessage(
      `@Claude-3.7-Sonnet 请基于电影《${movieTitle}》为我推荐6部类似的电影。
      
1. 你的回复应包括：电影名称（中英文）、年份、导演、主演、简短的电影简介、以及为什么推荐这部电影。
2. 请使用markdown格式，为每部电影创建一个漂亮的标题，并突出显示每个要素。
3. 开头请简要分析《${movieTitle}》的风格和特点，解释你推荐的依据。
4. 所有回复使用中文。`,
      {
        handler: "claude-handler",
        stream: true,
        openChat: false
      }
    );
  } catch (err) {
    handleAIError(err);
  }
}

// 处理AI错误
function handleAIError(err) {
  elements.loadingState.classList.add('hidden');
  elements.unknownMovieResults.classList.remove('hidden');
  elements.aiRecommendation.innerHTML = `
    <div class="p-4 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-lg flex items-start">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
      </svg>
      <span>获取推荐时出错: ${err.message || "未知错误"}</span>
    </div>`;
}

// 注册大语言模型响应处理程序
window.Poe.registerHandler("claude-handler", (result) => {
  const msg = result.responses[0];

  if (msg.status === "error") {
    elements.loadingState.classList.add('hidden');
    elements.unknownMovieResults.classList.remove('hidden');
    elements.aiRecommendation.innerHTML = `
      <div class="p-4 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 rounded-lg flex items-start">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <span>错误: ${msg.statusText || "获取推荐时出错"}</span>
      </div>`;
  } else if (msg.status === "incomplete") {
    elements.loadingState.classList.add('hidden');
    elements.unknownMovieResults.classList.remove('hidden');
    // 使用marked.js渲染Markdown，即使是部分内容
    elements.aiRecommendation.innerHTML = marked.parse(msg.content);
    enhanceRenderedContent(elements.aiRecommendation);
  } else if (msg.status === "complete") {
    elements.loadingState.classList.add('hidden');
    elements.unknownMovieResults.classList.remove('hidden');
    // 使用marked.js渲染Markdown
    elements.aiRecommendation.innerHTML = marked.parse(msg.content);
    // 增强渲染后的内容样式
    enhanceRenderedContent(elements.aiRecommendation);
  }
});

// 增强渲染后的内容样式
function enhanceRenderedContent(container) {
  // 增强标题样式
  const h1Elements = container.querySelectorAll('h1');
  h1Elements.forEach(heading => {
    heading.classList.add('text-2xl', 'font-bold', 'mt-6', 'mb-3', 'text-gray-800', 'dark:text-white', 'pb-2', 'border-b', 'border-gray-200', 'dark:border-gray-700');
  });
  
  const h2Elements = container.querySelectorAll('h2');
  h2Elements.forEach(heading => {
    heading.classList.add('text-xl', 'font-bold', 'mt-5', 'mb-3', 'text-primary', 'flex', 'items-center');
    // 添加图标到h2标题
    const icon = document.createElement('span');
    icon.className = 'mr-2 inline-flex items-center justify-center';
    icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm3 2h6v4H7V5zm8 8v2h1v-2h-1zm-2-8h1V5h-1v2zm-2 8h1v-2h-1v2zm-2 0h1v-2h-1v2zm-2 0h1v-2H9v2zm-2 0h1v-2H7v2zm-2 0h1v-2H5v2zm0-4h1v-2H5v2zm10 0h1v-2h-1v2zm-2 0h1v-2h-1v2zm-2 0h1v-2h-1v2zm-2 0h1v-2H9v2zm-2 0h1v-2H7v2z" clip-rule="evenodd" />
    </svg>`;
    heading.insertBefore(icon, heading.firstChild);
  });
  
  const h3Elements = container.querySelectorAll('h3');
  h3Elements.forEach(heading => {
    heading.classList.add('text-lg', 'font-semibold', 'mt-4', 'mb-2', 'text-gray-800', 'dark:text-gray-200');
  });

  // 增强列表样式
  const lists = container.querySelectorAll('ul, ol');
  lists.forEach(list => {
    list.classList.add('my-3', 'pl-5', 'space-y-2');
  });

  // 增强列表项样式
  const listItems = container.querySelectorAll('li');
  listItems.forEach(item => {
    item.classList.add('mb-1', 'text-gray-700', 'dark:text-gray-300');
  });

  // 增强段落样式
  const paragraphs = container.querySelectorAll('p');
  paragraphs.forEach(p => {
    p.classList.add('my-2', 'text-gray-700', 'dark:text-gray-300');
  });

  // 增强粗体样式
  const boldElements = container.querySelectorAll('strong');
  boldElements.forEach(el => {
    el.classList.add('text-gray-800', 'dark:text-gray-100', 'font-semibold');
  });

  // 增强链接样式
  const links = container.querySelectorAll('a');
  links.forEach(link => {
    link.classList.add('text-primary', 'hover:text-secondary', 'transition-colors');
    link.setAttribute('target', '_blank');
    link.setAttribute('rel', 'noopener noreferrer');
  });

  // 增强引用样式
  const blockquotes = container.querySelectorAll('blockquote');
  blockquotes.forEach(quote => {
    quote.classList.add('pl-4', 'border-l-4', 'border-primary', 'italic', 'my-4', 'text-gray-600', 'dark:text-gray-400');
  });

  // 增强电影名称的样式（假设电影名称出现在strong标签内）
  const movieTitles = container.querySelectorAll('strong');
  movieTitles.forEach(title => {
    if (title.textContent.includes('《') && title.textContent.includes('》')) {
      title.classList.add('text-primary', 'font-bold');
    }
  });

  // 添加动画效果到内容中
  const contentBlocks = container.querySelectorAll('h2, p, ul');
  contentBlocks.forEach((block, index) => {
    block.classList.add('animate-fade-in');
    block.style.animationDelay = `${index * 0.1}s`;
    block.style.opacity = '0';
    setTimeout(() => {
      block.style.opacity = '1';
    }, index * 100);
  });
}

// 创建提示消息
function showToast(message, type = 'info') {
  // 首先干净地移除现有提示
  const existingToasts = elements.toastContainer.querySelectorAll('.toast-notification');
  existingToasts.forEach(toast => {
    // 标记为正在退出
    toast.classList.add('exiting');

    // 添加淡出动画
    toast.classList.remove('animate-fade-in');
    toast.classList.add('animate-fade-out');

    // 动画结束后移除
    setTimeout(() => {
      if (toast.parentNode) {
        toast.parentNode.removeChild(toast);
      }
    }, 300);
  });

  // 创建新提示
  const toast = document.createElement('div');
  toast.className = 'toast-notification p-1 rounded-lg shadow-lg animate-fade-in my-2 blurred-bg';
  toast.setAttribute('role', 'alert');
  toast.setAttribute('aria-live', 'polite');

  let bgColor, textColor, icon;

  switch (type) {
    case 'success':
      bgColor = 'bg-green-50 dark:bg-green-900/30';
      textColor = 'text-green-800 dark:text-green-200';
      icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
      break;
    case 'warning':
      bgColor = 'bg-yellow-50 dark:bg-yellow-900/30';
      textColor = 'text-yellow-800 dark:text-yellow-200';
      icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>';
      break;
    case 'error':
      bgColor = 'bg-red-50 dark:bg-red-900/30';
      textColor = 'text-red-800 dark:text-red-200';
      icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>';
      break;
    default: // info
      bgColor = 'bg-blue-50 dark:bg-blue-900/30';
      textColor = 'text-blue-800 dark:text-blue-200';
      icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" /></svg>';
  }

  toast.innerHTML = `
    <div class="flex items-center ${bgColor} ${textColor} px-4 py-2 rounded-md">
      <span class="mr-2 flex-shrink-0">${icon}</span>
      <span>${message}</span>
    </div>
  `;

  elements.toastContainer.appendChild(toast);

  // 3秒后自动消失
  setTimeout(() => {
    if (!toast.classList.contains('exiting')) {
      toast.classList.add('exiting');
      toast.classList.remove('animate-fade-in');
      toast.classList.add('animate-fade-out');

      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }
  }, 3000);
}

// 防抖函数
function debounce(func, wait) {
  let timeout;
  return function(...args) {
    const context = this;
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(context, args), wait);
  };
}
</script>
</body>
</html>
